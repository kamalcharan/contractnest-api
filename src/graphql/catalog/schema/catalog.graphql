# src/graphql/catalog/schema/catalog.graphql
# Complete GraphQL schema for Service Catalog functionality
# Includes all catalog operations, versioning, and environment support

# =================================================================
# SCALAR TYPES (defined in scalars.graphql)
# =================================================================

# scalar DateTime
# scalar JSON
# scalar UUID

# =================================================================
# ENUMS (unique to catalog)
# =================================================================

enum CatalogItemType {
  SERVICE
  EQUIPMENT
  SPARE_PART
  ASSET
}

enum CatalogItemStatus {
  ACTIVE
  INACTIVE
  DRAFT
}

enum PricingType {
  FIXED
  UNIT_PRICE
  HOURLY
  DAILY
  MONTHLY
  PACKAGE
  SUBSCRIPTION
  PRICE_RANGE
}

enum BillingMode {
  MANUAL
  AUTOMATIC
}

enum CatalogItemSortField {
  NAME
  CREATED_AT
  UPDATED_AT
  VERSION_NUMBER
  BASE_AMOUNT
}

# =================================================================
# INPUT TYPES (catalog-specific)
# =================================================================

# Pricing Configuration Input
input PriceAttributesInput {
  type: PricingType!
  base_amount: Float!
  currency: String!
  billing_mode: BillingMode!
  min_amount: Float
  max_amount: Float
  hourly_rate: Float
  daily_rate: Float
  monthly_rate: Float
  package_details: PackageDetailsInput
  subscription_details: SubscriptionDetailsInput
  custom_pricing_rules: [JSON!]
}

input PackageDetailsInput {
  sessions: Int!
  validity_days: Int!
  discount_percentage: Float
}

input SubscriptionDetailsInput {
  billing_cycle: String!
  setup_fee: Float
  trial_days: Int
}

# Tax Configuration Input
input TaxConfigInput {
  use_tenant_default: Boolean!
  display_mode: String
  specific_tax_rates: [UUID!]
}

# Create Catalog Item Input
input CreateCatalogItemInput {
  name: String!
  type: CatalogItemType!
  price_attributes: PriceAttributesInput!
  industry_id: UUID
  category_id: UUID
  short_description: String
  description_content: String
  description_format: ContentFormat
  terms_content: String
  terms_format: ContentFormat
  service_parent_id: UUID
  is_variant: Boolean
  variant_attributes: JSON
  tax_config: TaxConfigInput
  metadata: JSON
  specifications: JSON
  status: CatalogItemStatus
  is_live: Boolean
}

# Update Catalog Item Input
input UpdateCatalogItemInput {
  version_reason: String!
  name: String
  short_description: String
  description_content: String
  description_format: ContentFormat
  terms_content: String
  terms_format: ContentFormat
  price_attributes: PriceAttributesInput
  tax_config: TaxConfigInput
  metadata: JSON
  specifications: JSON
  status: CatalogItemStatus
  variant_attributes: JSON
  industry_id: UUID
  category_id: UUID
}

input CatalogItemFiltersInput {
  type: [CatalogItemType!]
  status: [CatalogItemStatus!]
  is_active: Boolean
  is_live: Boolean
  industry_id: [UUID!]
  category_id: [UUID!]
  search_query: String
  search_fields: [String!]
  service_parent_id: UUID
  is_variant: Boolean
  include_variants: Boolean
  pricing_type: [PricingType!]
  min_price: Float
  max_price: Float
  currency: String
  current_versions_only: Boolean
  include_inactive: Boolean
  created_after: DateTime
  created_before: DateTime
  updated_after: DateTime
  updated_before: DateTime
  created_by: UUID
}

# Catalog-specific sort input
input CatalogSortInput {
  field: CatalogItemSortField
  direction: SortDirection
}

# Catalog Query Input
input CatalogItemQueryInput {
  filters: CatalogItemFiltersInput
  pagination: PaginationInput
  sort: [CatalogSortInput!]
  include_related: Boolean
  include_versions: Boolean
}

# Bulk Operation Input
input BulkCatalogItemInput {
  operation: String!
  items: [JSON!]!
  options: JSON
}

# Environment Operation Input
input EnvironmentOperationInput {
  from_environment: Environment!
  to_environment: Environment!
  item_ids: [UUID!]
}

# =================================================================
# OUTPUT TYPES (catalog-specific)
# =================================================================

# Pricing Configuration
type PriceAttributes {
  type: PricingType!
  base_amount: Float!
  currency: String!
  billing_mode: BillingMode!
  min_amount: Float
  max_amount: Float
  hourly_rate: Float
  daily_rate: Float
  monthly_rate: Float
  package_details: PackageDetails
  subscription_details: SubscriptionDetails
  custom_pricing_rules: [JSON!]
}

type PackageDetails {
  sessions: Int!
  validity_days: Int!
  discount_percentage: Float
}

type SubscriptionDetails {
  billing_cycle: String!
  setup_fee: Float
  trial_days: Int
}

# Tax Configuration
type TaxConfig {
  use_tenant_default: Boolean!
  display_mode: String
  specific_tax_rates: [UUID!]!
}

# Industry Information
type CatalogIndustry {
  id: UUID!
  tenant_id: UUID!
  is_live: Boolean!
  industry_code: String!
  name: String!
  description: String
  icon: String
  common_pricing_rules: [JSON!]!
  compliance_requirements: [JSON!]!
  is_custom: Boolean!
  master_industry_id: String
  customization_notes: String
  is_active: Boolean!
  sort_order: Int!
  created_at: DateTime!
  updated_at: DateTime!
  created_by: UUID
  updated_by: UUID
  
  # Related data
  categories: [CatalogCategory!]!
  
  # Computed fields
  item_count: Int!
}

# Category Information
type CatalogCategory {
  id: UUID!
  tenant_id: UUID!
  industry_id: UUID!
  is_live: Boolean!
  category_code: String!
  name: String!
  description: String
  icon: String
  default_pricing_model: PricingType!
  suggested_duration: Int
  common_variants: [String!]!
  pricing_rule_templates: [JSON!]!
  is_custom: Boolean!
  master_category_id: String
  customization_notes: String
  is_active: Boolean!
  sort_order: Int!
  created_at: DateTime!
  updated_at: DateTime!
  created_by: UUID
  updated_by: UUID
  
  # Related data
  industry: CatalogIndustry
  items: [CatalogItem!]!
  
  # Computed fields
  item_count: Int!
}

# Main Catalog Item
type CatalogItem {
  id: UUID!
  tenant_id: UUID!
  is_live: Boolean!
  
  # Versioning fields
  original_item_id: UUID
  parent_version_id: UUID
  version_number: Int!
  is_current_version: Boolean!
  replaced_by_id: UUID
  version_reason: String
  
  # Item classification
  type: CatalogItemType!
  industry_id: UUID
  category_id: UUID
  
  # Basic information
  name: String!
  short_description: String
  
  # Rich content
  description_format: ContentFormat!
  description_content: String
  terms_format: ContentFormat!
  terms_content: String
  
  # Service hierarchy (different from versioning)
  service_parent_id: UUID
  is_variant: Boolean!
  variant_attributes: JSON!
  
  # Pricing and tax
  price_attributes: PriceAttributes!
  tax_config: TaxConfig!
  
  # Flexible metadata
  metadata: JSON!
  specifications: JSON!
  
  # Status
  is_active: Boolean!
  status: CatalogItemStatus!
  
  # Audit fields
  created_at: DateTime!
  updated_at: DateTime!
  created_by: UUID
  updated_by: UUID
  
  # Related data
  industry: CatalogIndustry
  category: CatalogCategory
  service_parent: CatalogItem
  variants: [CatalogItem!]!
  
  # Computed fields
  variant_count: Int!
  original_id: UUID!
  total_versions: Int!
  
  # Extracted pricing info
  pricing_type: PricingType!
  base_amount: Float!
  currency: String!
  billing_mode: BillingMode!
  
  # Tax information
  use_tenant_default_tax: Boolean!
  tax_display_mode: String
  specific_tax_count: Int!
  
  # Environment
  environment_label: String!
}

# Version History
type VersionInfo {
  version_id: UUID!
  version_number: Int!
  version_reason: String
  created_at: DateTime!
  created_by: UUID
  created_by_name: String
  is_current: Boolean!
  price_at_version: PriceAttributes!
  name_at_version: String!
}

# Version History Response
type VersionHistoryResponse {
  versions: [VersionInfo!]!
  original_item_id: UUID!
  current_version_id: UUID!
  total_versions: Int!
}

# Catalog-specific bulk operation result
type CatalogBulkOperationResult {
  total_requested: Int!
  successful: Int!
  failed: Int!
  errors: [BulkOperationError!]!
  created_ids: [UUID!]
  updated_ids: [UUID!]
}

# Environment Operation Result
type EnvironmentOperationResult {
  success: Boolean!
  industries_copied: Int
  categories_copied: Int
  items_copied: Int
  message: String!
}

# Statistics and Analytics
type CatalogStatistics {
  total_items: Int!
  by_type: [CatalogTypeCount!]!
  by_status: [CatalogStatusCount!]!
  by_pricing_type: [CatalogPricingCount!]!
  by_industry: [CatalogIndustryCount!]!
  recent_activity: [CatalogActivity!]!
}

type CatalogTypeCount {
  type: CatalogItemType!
  count: Int!
}

type CatalogStatusCount {
  status: CatalogItemStatus!
  count: Int!
}

type CatalogPricingCount {
  pricing_type: PricingType!
  count: Int!
}

type CatalogIndustryCount {
  industry_id: UUID!
  industry_name: String!
  count: Int!
}

type CatalogActivity {
  action: String!
  item_id: UUID!
  item_name: String!
  user_name: String
  timestamp: DateTime!
}

# Search Results with Facets
type CatalogSearchResults {
  items: [CatalogItem!]!
  pagination: PaginationInfo!
  facets: CatalogSearchFacets!
  query_info: SearchQueryInfo!
}

type CatalogSearchFacets {
  types: [FacetCount!]!
  industries: [FacetCount!]!
  categories: [FacetCount!]!
  pricing_types: [FacetCount!]!
  price_ranges: [PriceRangeFacet!]!
}

type FacetCount {
  value: String!
  label: String!
  count: Int!
}

type PriceRangeFacet {
  min: Float!
  max: Float!
  count: Int!
  label: String!
}

type SearchQueryInfo {
  query: String
  total_results: Int!
  search_time_ms: Int!
  suggestions: [String!]!
}

# Catalog-specific response types
type CatalogItemResponse {
  item: CatalogItem
  validation: ValidationResult
  message: String
}

type CatalogItemListResponse {
  items: [CatalogItem!]!
  pagination: PaginationInfo!
  message: String
}

# =================================================================
# QUERIES
# =================================================================

type Query {
  # Health check
  hello: String
  health: HealthStatus
  
  # Single item queries
  catalogItem(id: UUID!, include_history: Boolean): CatalogItemResponse!
  
  # List and search queries
  catalogItems(query: CatalogItemQueryInput!): CatalogItemListResponse!
  searchCatalogItems(query: String!, filters: CatalogItemFiltersInput, pagination: PaginationInput): CatalogSearchResults!
  
  # Version queries
  catalogItemHistory(id: UUID!): VersionHistoryResponse!
  catalogItemVersion(version_id: UUID!): CatalogItemResponse!
  
  # Industry and category queries
  catalogIndustries(is_live: Boolean): [CatalogIndustry!]!
  catalogCategories(industry_id: UUID, is_live: Boolean): [CatalogCategory!]!
  
  # Analytics and statistics
  catalogStatistics(is_live: Boolean, date_range: [DateTime!]): CatalogStatistics!
  
  # Master data for onboarding
  masterIndustries: [JSON!]!
  masterCategories(industry_ids: [String!]!): [JSON!]!
  
  # Environment comparison
  compareEnvironments(item_ids: [UUID!]): [JSON!]!
  
  # Validation
  validateCatalogItem(input: CreateCatalogItemInput!): ValidationResult!
  validateCatalogUpdate(id: UUID!, input: UpdateCatalogItemInput!): ValidationResult!
}

# =================================================================
# MUTATIONS
# =================================================================

type Mutation {
  # CRUD Operations
  createCatalogItem(input: CreateCatalogItemInput!): CatalogItemResponse!
  updateCatalogItem(id: UUID!, input: UpdateCatalogItemInput!): CatalogItemResponse!
  deleteCatalogItem(id: UUID!): MutationResponse!
  duplicateCatalogItem(id: UUID!, new_name: String!): CatalogItemResponse!
  
  # Status operations
  activateCatalogItem(id: UUID!): CatalogItemResponse!
  deactivateCatalogItem(id: UUID!): CatalogItemResponse!
  publishCatalogItem(id: UUID!): CatalogItemResponse!
  
  # Bulk operations
  bulkCreateCatalogItems(input: BulkCatalogItemInput!): CatalogBulkOperationResult!
  bulkUpdateCatalogItems(input: BulkCatalogItemInput!): CatalogBulkOperationResult!
  bulkDeleteCatalogItems(ids: [UUID!]!): CatalogBulkOperationResult!
  bulkActivateCatalogItems(ids: [UUID!]!): CatalogBulkOperationResult!
  bulkDeactivateCatalogItems(ids: [UUID!]!): CatalogBulkOperationResult!
  
  # Environment operations
  copyLiveToTest(input: EnvironmentOperationInput): EnvironmentOperationResult!
  promoteTestToLive(input: EnvironmentOperationInput): EnvironmentOperationResult!
  syncEnvironments(input: EnvironmentOperationInput): EnvironmentOperationResult!
  
  # Tenant onboarding
  setupTenantCatalog(industry_ids: [String!]!, copy_to_test: Boolean): EnvironmentOperationResult!
  
  # Industry and category management
  createCustomIndustry(name: String!, description: String, icon: String): CatalogIndustry!
  createCustomCategory(industry_id: UUID!, name: String!, description: String, icon: String): CatalogCategory!
  updateCatalogIndustry(id: UUID!, name: String, description: String, icon: String): CatalogIndustry!
  updateCatalogCategory(id: UUID!, name: String, description: String, icon: String): CatalogCategory!
  
  # Variant management
  createServiceVariant(parent_id: UUID!, variant_data: CreateCatalogItemInput!): CatalogItemResponse!
  linkServiceVariant(parent_id: UUID!, variant_id: UUID!): MutationResponse!
  unlinkServiceVariant(variant_id: UUID!): MutationResponse!
}

# =================================================================
# SUBSCRIPTIONS
# =================================================================

type Subscription {
  # Real-time catalog updates
  catalogItemUpdated(tenant_id: UUID!, is_live: Boolean): CatalogItem!
  catalogItemCreated(tenant_id: UUID!, is_live: Boolean): CatalogItem!
  catalogItemDeleted(tenant_id: UUID!, is_live: Boolean): UUID!
  
  # Bulk operation progress
  bulkOperationProgress(operation_id: UUID!): JSON!
  
  # Environment sync progress
  environmentSyncProgress(tenant_id: UUID!): JSON!
  
  # Statistics updates
  catalogStatisticsUpdated(tenant_id: UUID!): CatalogStatistics!
}